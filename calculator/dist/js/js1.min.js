var paraJack={method:{getData:null,pushChar:null,popChar:null,removeResult:null,clearStr:null,isStrLegal:null,calculate:null},dom:{setEvent:null,handleInput:null,update:null}};!function(){var r={isCalculated:!1,result:"",currentStr:"",strArr:[],isStrLegal:!0};paraJack.method.getData=function(){var t={};return t.isCalculated=r.isCalculated,t.result=r.result,t.currentStr=r.currentStr,t.strArr=r.strArr.concat(),t.isStrLegal=r.isStrLegal,t},paraJack.method.pushChar=function(t){if("string"!=typeof t)return!1;switch(r.isCalculated&&(r.strArr=[r.result],r.currentStr=r.result,r.result="",r.isCalculated=!1),t){case"&minus;":case"+":case"&times;":case"&divide;":case"%":return r.strArr.push(t),r.currentStr="",!0;case".":return r.currentStr?r.currentStr.indexOf(".")>=0?(r.currentStr=t,r.strArr.push(r.currentStr)):(r.currentStr+=t,r.strArr[r.strArr.length-1]=r.currentStr):(r.currentStr=t,r.strArr.push(r.currentStr)),!0;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return r.currentStr?(r.currentStr+=t,r.strArr[r.strArr.length-1]=r.currentStr):(r.currentStr+=t,r.strArr.push(r.currentStr)),!0;default:return!1}},paraJack.method.popChar=function(){var t="",e=r.strArr.length,a="",s="";return r.isCalculated?(r.isCalculated=!1,r.result=""):(e>0&&(0===(s=(a=r.strArr[e-1]).charAt(a.length-1)).search(/[0-9]|\./)?(t=s,(a=a.substr(0,a.length-1))?r.strArr[e-1]=a:r.strArr.pop()):(t=a,r.strArr.pop())),(e=r.strArr.length)>0?(a=r.strArr[e-1],r.currentStr="+"===a||"&minus;"===a||"&times;"===a||"&divide;"===a||"%"===a?"":a):r.currentStr=""),t},paraJack.method.removeResult=function(){r.result="",r.isCalculated=!1},paraJack.method.clearStr=function(){return r.strArr.length>0&&(r.strArr=[],r.currentStr="",r.isCalculated=!1,r.result="",!0)},paraJack.method.isStrLegal=function(t){var e=r.strArr.concat(),a=e.length;if(e=e.map(function(r,t,e){switch(r){case"+":case"&minus;":return"operator1";case"&times;":case"%":case"&divide;":return"operator2";case".":return"point";default:return"number"}}),!1===t&&a>0){var s=e[a-1];"operator1"===s||"operator2"===s?e.push("number"):e[a-1]="number"}switch(a=e.length){case 0:return!0;case 1:return"number"===e[0];case 2:return"operator1"===e[0]&&"number"===e[1];default:return("operator1"===e[0]||"number"===e[0])&&e.every(function(r,t,e){switch(t){case a-1:return"number"===r;case 0:return r===(a%2==0?"operator1":"number");default:return(a-1-t)%2==0?"number"===r:"operator1"===r||"operator2"===r}})}},paraJack.method.calculate=function(){var t=paraJack.method.getData().strArr,e=t;lenOrigin=t.length,len=lenOrigin,i=1,operater="",isStrLegal=paraJack.method.isStrLegal();var a=function(r){var t=r.indexOf("."),e=r.indexOf("e"),a=0,s={};return e>0?a=t>=0?e-t-parseInt(r.slice(e+1)):-parseInt(r.slice(e+1),10):t>=0&&(a=r.length-1-t),a>0?(s.pow=a,s.str=(parseFloat(r)*Math.pow(10,a)).toString()):(s.pow=0,s.str=r),s};if(isStrLegal){for((lenOrigin>0&&"+"===t[0]||"&minus;"===t[0])&&t.unshift("0"),e=t.map(function(r,t,e){var s=a(r);return e[t]=s.str,s.pow});i<t.length;){operator=t[i];var s=e[i-1],c=e[i+1],n=Math.max(s,c),u=parseFloat(t[i-1],10)*Math.pow(10,n-s),l=parseFloat(t[i+1],10)*Math.pow(10,n-c);switch(operator){case"&times;":temp=u*l/Math.pow(10,2*n),t.splice(i-1,3,a(String(temp)).str),e.splice(i-1,3,a(String(temp)).pow);break;case"&divide;":temp=u/l,t.splice(i-1,3,a(String(temp)).str),e.splice(i-1,3,a(String(temp)).pow);break;case"%":temp=u%l/Math.pow(10,n),t.splice(i-1,3,a(String(temp)).str),e.splice(i-1,3,a(String(temp)).pow);break;default:i+=2}}for(i=1;i<t.length;){operator=t[i];var s=e[i-1],c=e[i+1],n=Math.max(s,c),u=parseFloat(t[i-1],10)*Math.pow(10,n-s),l=parseFloat(t[i+1],10)*Math.pow(10,n-c);switch(operator){case"+":temp=(u+l)/Math.pow(10,n),t.splice(i-1,3,a(String(temp)).str),e.splice(i-1,3,a(String(temp)).pow);break;case"&minus;":temp=(u-l)/Math.pow(10,n),t.splice(i-1,3,a(String(temp)).str),e.splice(i-1,3,a(String(temp)).pow);break;default:i+=2}}}return lenOrigin>0&&isStrLegal?(r.isCalculated=!0,r.result=String(parseFloat(t[0],16)/Math.pow(10,e[0]))):""},paraJack.dom.setEvent=function(){$("#calculator table").on("click","td",function(r){var t=$(r.target).attr("data-mask");paraJack.dom.handleInput(t)})},paraJack.dom.handleInput=function(r){if("string"==typeof r)switch(r){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case".":case"+":case"%":paraJack.method.pushChar(r),paraJack.dom.update();break;case"minus":case"times":case"divide":paraJack.method.pushChar("&"+r+";"),paraJack.dom.update();break;case"clear":paraJack.method.clearStr(),paraJack.dom.update();break;case"back":paraJack.method.popChar(),paraJack.dom.update();break;case"=":paraJack.method.calculate(),paraJack.dom.update()}},paraJack.dom.update=function(){var t=$("div.output span"),e=($("#calculator p.alert"),r.result),a=e.length,s=r.strArr.concat();r.isCalculated?a>20?t.html(parseFloat(e).toExponential(20)):t.html(e):(paraJack.method.isStrLegal(r.isCalculated)?t.removeClass("wrong"):t.addClass("wrong"),t.html(s.join("")))}}(),$(document).ready(function(){paraJack.dom.setEvent()});