var paraJack={method:{getData:null,pushChar:null,popChar:null,removeResult:null,clearStr:null,isStrLegal:null,calculate:null},dom:{setEvent:null,handleInput:null,update:null}};!function(){var r={isCalculated:!1,result:"",currentStr:"",strArr:[],isStrLegal:!0};paraJack.method.getData=function(){var t={};return t.isCalculated=r.isCalculated,t.result=r.result,t.currentStr=r.currentStr,t.strArr=r.strArr.concat(),t.isStrLegal=r.isStrLegal,t},paraJack.method.pushChar=function(t){if("string"!=typeof t)return!1;switch(r.isCalculated&&paraJack.method.clearStr(),t){case"&minus;":case"+":case"&times;":case"&divide;":case"%":return r.strArr.push(t),r.currentStr="",!0;case".":return r.currentStr?r.currentStr.indexOf(".")>=0?(r.currentStr=t,r.strArr.push(r.currentStr)):(r.currentStr+=t,r.strArr[r.strArr.length-1]=r.currentStr):(r.currentStr=t,r.strArr.push(r.currentStr)),!0;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return r.currentStr?(r.currentStr+=t,r.strArr[r.strArr.length-1]=r.currentStr):(r.currentStr+=t,r.strArr.push(r.currentStr)),!0;default:return!1}},paraJack.method.popChar=function(){var t="",a=r.strArr.length,e="",s="";return r.isCalculated?(r.isCalculated=!1,r.result=""):(a>0&&(0===(s=(e=r.strArr[a-1]).charAt(e.length-1)).search(/[0-9]|\./)?(t=s,(e=e.substr(0,e.length-1))?r.strArr[a-1]=e:r.strArr.pop()):(t=e,r.strArr.pop())),(a=r.strArr.length)>0?(e=r.strArr[a-1],r.currentStr="+"===e||"&minus;"===e||"&times;"===e||"&divide;"===e||"%"===e?"":e):r.currentStr=""),t},paraJack.method.removeResult=function(){r.result="",r.isCalculated=!1},paraJack.method.clearStr=function(){return r.strArr.length>0&&(r.strArr=[],r.currentStr="",r.isCalculated=!1,r.result="",!0)},paraJack.method.isStrLegal=function(t){var a=r.strArr.concat(),e=a.length;if(a=a.map(function(r,t,a){switch(r){case"+":case"&minus;":return"operator1";case"&times;":case"%":case"&divide;":return"operator2";case".":return"point";default:return"number"}}),!1===t&&e>0){var s=a[e-1];"operator1"===s||"operator2"===s?a.push("number"):a[e-1]="number"}switch(e=a.length){case 0:return!0;case 1:return"number"===a[0];case 2:return"operator1"===a[0]&&"number"===a[1];default:return("operator1"===a[0]||"number"===a[0])&&a.every(function(r,t,a){switch(t){case e-1:return"number"===r;case 0:return r===(e%2==0?"operator1":"number");default:return(e-1-t)%2==0?"number"===r:"operator1"===r||"operator2"===r}})}},paraJack.method.calculate=function(){var t=paraJack.method.getData().strArr,a=t;lenOrigin=t.length,len=lenOrigin,i=1,operater="",isStrLegal=paraJack.method.isStrLegal();var e=function(r){var t=r.indexOf("."),a=r.indexOf("e"),e=0,s={};return a>0?e=t>=0?a-t-parseInt(r.slice(a+1)):-parseInt(r.slice(a+1),10):t>=0&&(e=r.length-1-t),e>0?(s.pow=e,s.str=(parseFloat(r)*Math.pow(10,e)).toString()):(s.pow=0,s.str=r),s};if(isStrLegal){for((lenOrigin>0&&"+"===t[0]||"&minus;"===t[0])&&t.unshift("0"),a=t.map(function(r,t,a){var s=e(r);return a[t]=s.str,s.pow});i<t.length;){operator=t[i];var s=a[i-1],c=a[i+1],n=Math.max(s,c),u=parseFloat(t[i-1],10)*Math.pow(10,n-s),l=parseFloat(t[i+1],10)*Math.pow(10,n-c);switch(operator){case"&times;":temp=u*l/Math.pow(10,2*n),t.splice(i-1,3,e(String(temp)).str),a.splice(i-1,3,e(String(temp)).pow);break;case"&divide;":temp=u/l,t.splice(i-1,3,e(String(temp)).str),a.splice(i-1,3,e(String(temp)).pow);break;case"%":temp=u%l/Math.pow(10,n),t.splice(i-1,3,e(String(temp)).str),a.splice(i-1,3,e(String(temp)).pow);break;default:i+=2}}for(i=1;i<t.length;){operator=t[i];var s=a[i-1],c=a[i+1],n=Math.max(s,c),u=parseFloat(t[i-1],10)*Math.pow(10,n-s),l=parseFloat(t[i+1],10)*Math.pow(10,n-c);switch(operator){case"+":temp=(u+l)/Math.pow(10,n),t.splice(i-1,3,e(String(temp)).str),a.splice(i-1,3,e(String(temp)).pow);break;case"&minus;":temp=(u-l)/Math.pow(10,n),t.splice(i-1,3,e(String(temp)).str),a.splice(i-1,3,e(String(temp)).pow);break;default:i+=2}}}return lenOrigin>0&&isStrLegal?(r.isCalculated=!0,r.result=parseFloat(t[0],16)/Math.pow(10,a[0])):""},paraJack.dom.setEvent=function(){$("#calculator table").on("click","td",function(r){var t=$(r.target).attr("data-mask");paraJack.dom.handleInput(t)})},paraJack.dom.handleInput=function(r){if("string"==typeof r)switch(r){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case".":case"+":case"%":paraJack.method.pushChar(r),paraJack.dom.update();break;case"minus":case"times":case"divide":paraJack.method.pushChar("&"+r+";"),paraJack.dom.update();break;case"clear":paraJack.method.clearStr(),paraJack.dom.update();break;case"back":paraJack.method.popChar(),paraJack.dom.update();break;case"=":paraJack.method.calculate(),paraJack.dom.update()}},paraJack.dom.update=function(){var t=$("div.output span"),a=($("#calculator p.alert"),r.result),e=a.length,s=r.strArr.concat();r.isCalculated?e>20?t.html(parseFloat(a).toExponential(20)):t.html(a):(paraJack.method.isStrLegal(r.isCalculated)?t.removeClass("wrong"):t.addClass("wrong"),t.html(s.join("")))}}(),$(document).ready(function(){paraJack.dom.setEvent()});