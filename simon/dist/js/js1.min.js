var paraJack={game:{newGame:null,open:null,close:null,showList:null,waitList:null,handleError:null,handleClick:null,showNth:null,genList:null,getRandomInt:null,playMusic:null,stopMusic:null,showSuccess:null,enableClick:null,disableClick:null,countShow:null},dom:{setEvent:null,getNodes:null},osc:{init:null,play:null,stop:null}};!function(){var a={states:["dead","silent","show","wait","error","win"],colors:["red","blue","green","yellow"],stateIndex:0,mode:"normal",show:[],get:[],curListCount:0,curIndex:-1,timerId:{showTimeout:0,waitTimeout:0,errorTimeout:0},computerSpeed:[{show:600,gap:600},{show:400,gap:400},{show:200,gap:200}],threshold:[8,12],opacity:{original:"0.7",full:"1"},checkGap:500,hasAudioCtx:!(!window.AudioContext&&!window.webkitAudioContext),audioCtx:null,oscFreqs:{red:300,blue:400,green:500,yellow:600},osc:null},e={$main:null,$red:null,$blue:null,$green:null,$yellow:null,$coontrol:null,$count:null,$start:null,$mode:null,$modeSlide:null,$onOff:null,$onOffSlide:null,$mp3:null};paraJack.osc.init=function(){if(a.hasAudioCtx)a.audioCtx=new(window.AudioContext||window.webkitAudioContext);else{e.$mp3.html('<audio id="red"><source src="mp3/red.mp3" type="audio/mpeg"><source src="mp3/red.wav"></audio><audio id="blue"><source src="mp3/blue.mp3" type="audio/mpeg"><source src="mp3/blue.wav"></audio><audio id="green"><source src="mp3/green.mp3" type="audio/mpeg"><source src="mp3/green.wav"></audio><audio id="yellow"><source src="mp3/yellow.mp3" type="audio/mpeg"><source src="mp3/yellow.wav"></audio><audio id="error"><source src="mp3/error.mp3" type="audio/mpeg"><source src="mp3/error.wav"></audio>')}},paraJack.osc.play=function(e){a.hasAudioCtx&&(a.osc&&a.osc.stop(),a.osc=a.audioCtx.createOscillator(),a.osc.frequency.value=e,a.osc.connect(a.audioCtx.destination),a.osc.start())},paraJack.osc.stop=function(){a.hasAudioCtx&&a.osc.stop()},paraJack.game.newGame=function(){paraJack.game.disableClick(),paraJack.game.countShow("--","bling"),clearTimeout(a.showTimeout),clearTimeout(a.waitTimeout),setTimeout(function(){paraJack.game.genList(),paraJack.game.showList(1)},1e3)},paraJack.game.open=function(){e.$start.addClass("active"),e.$mode.find(".slide").addClass("active"),paraJack.game.disableClick(),a.stateIndex=1,paraJack.game.countShow("--","still")},paraJack.game.close=function(){e.$start.removeClass("active"),e.$mode.find(".slide").removeClass("active"),e.$mode.find(".inner").removeClass("strict"),e.$red.removeClass("active"),e.$blue.removeClass("active"),e.$green.removeClass("active"),e.$yellow.removeClass("active"),paraJack.game.countShow("","still"),clearTimeout(a.showTimeout),clearTimeout(a.waitTimeout),a.stateIndex=0,a.mode="normal",show=[],get=[]},paraJack.game.showList=function(e){a.stateIndex=2,paraJack.game.countShow(e,"still"),a.curListCount=e,a.curIndex=0,paraJack.game.disableClick();a.showTimeout=setTimeout(function(){var o=e<a.threshold[0]?a.computerSpeed[0].gap:e<a.threshold[1]?a.computerSpeed[1].gap:a.computerSpeed[2].gap,t=e<a.threshold[0]?a.computerSpeed[0].show:e<a.threshold[1]?a.computerSpeed[1].show:a.computerSpeed[2].show;a.curIndex<e&&paraJack.game.showNth(a.curIndex++,t),a.curIndex<e?a.showTimeout=setTimeout(arguments.callee,o+t):a.showTimeout=setTimeout(function(){paraJack.game.waitList(e)},t)},1e3)},paraJack.game.waitList=function(e){a.stateIndex=3,a.get=[],a.curIndex=-1,paraJack.game.enableClick();var o=-1,t=0;a.waitTimeout=setTimeout(function(){3===a.stateIndex&&(a.curIndex<e-1?a.curIndex===o&&t>=5500?paraJack.game.handleError():(a.curIndex===o?t+=500:(t=0,o=a.curIndex),a.waitTimeout=setTimeout(arguments.callee,a.checkGap)):20===e?(paraJack.game.showSuccess(),paraJack.game.open()):paraJack.game.showList(++a.curListCount))},a.checkGap)},paraJack.game.handleError=function(){a.stateIndex=4,paraJack.game.disableClick(),paraJack.game.stopMusic(),e.$main.find(".color-block").each(function(){$(this).css({opacity:a.opacity.original})}),paraJack.game.countShow("!!","bling"),paraJack.game.playMusic("error"),a.timerId.errorTimeout=setTimeout(function(){"normal"===a.mode?paraJack.game.showList(a.curListCount):(a.curListCount=1,paraJack.game.showList(1))},1e3)},paraJack.game.handleClick=function(e){a.get.push(e),a.curIndex+=1,a.show[a.get.length-1]!==e&&paraJack.game.handleError()},paraJack.game.showNth=function(o,t){e["$"+a.show[o]].fadeTo(10,a.opacity.full,function(){paraJack.game.playMusic(a.show[o])}).fadeTo(t-10,a.opacity.full,function(){$(this).css({opacity:a.opacity.original}),paraJack.game.stopMusic(a.show[o])})},paraJack.game.genList=function(){a.show=[];for(var e=0;e<20;e++)a.show.push(a.colors[paraJack.game.getRandomInt(0,3)])},paraJack.game.getRandomInt=function(a,e){return Math.floor(Math.random()*(e-a+1)+a)},paraJack.game.playMusic=function(o){a.hasAudioCtx&&"error"!==o?paraJack.osc.play(a.oscFreqs[o]):e.$mp3.find("#"+o)[0].play()},paraJack.game.stopMusic=function(o){if(a.hasAudioCtx&&paraJack.osc.stop(),!a.hasAudioCtx||"error"===o)if(void 0!==o)t=e.$mp3.find("#"+o)[0];else for(var t=null,n=a.colors.concat("error"),c=0;c<n.length;c++)(t=e.$mp3.find("#"+n[c])[0]).pause(),t.currentTime=0},paraJack.game.showSuccess=function(){$("div.success").slideDown()},paraJack.game.enableClick=function(){e.$red.addClass("active"),e.$blue.addClass("active"),e.$green.addClass("active"),e.$yellow.addClass("active")},paraJack.game.disableClick=function(){e.$red.removeClass("active"),e.$blue.removeClass("active"),e.$green.removeClass("active"),e.$yellow.removeClass("active")},paraJack.game.countShow=function(a,o){if("still"===o)e.$count.find("span").html(a);else{var t=e.$count.find("span");t.html(a),t.fadeToggle(200).fadeToggle(200).fadeToggle(200).fadeToggle(200)}},paraJack.dom.setEvent=function(){for(var o=["red","blue","green","yellow"],t=0;t<o.length;t++)!function(a){e.$main.on("mousedown","."+a+".active",function(){e["$"+a].css({opacity:1}),paraJack.game.playMusic(a)}),e.$main.on("mouseup","."+a+".active",function(){e["$"+a].css({opacity:.7}),paraJack.game.stopMusic(a),paraJack.game.handleClick(a)})}(o[t]);e.$mode.on("click",".slide.active",function(){$(this).find(".inner").toggleClass("strict"),a.mode="strict"===a.mode?"normal":"strict"}),e.$onOff.on("click",".slide",function(){$(this).find(".inner").toggleClass("on"),0!==a.stateIndex?(a.stateIndex=0,paraJack.game.close()):(a.stateIndex=1,paraJack.game.open())}),e.$control.on("click",".start.active",function(){paraJack.game.newGame()}),$(".success button").on("click",function(){$("div.success").hide()})},paraJack.dom.getNodes=function(){e.$main=$(".main"),e.$red=e.$main.find(".red"),e.$blue=e.$main.find(".blue"),e.$green=e.$main.find(".green"),e.$yellow=e.$main.find(".yellow"),e.$control=e.$main.find(".control"),e.$count=e.$control.find(".count"),e.$start=e.$control.find(".start"),e.$mode=e.$control.find(".mode"),e.$modeSlide=e.$mode.find(".slide"),e.$onOff=e.$control.find(".on-off"),e.$onOffSlide=e.$onOff.find(".slide"),e.$mp3=$(".mp3")}}(),$(document).ready(function(){paraJack.dom.getNodes(),paraJack.dom.setEvent(),paraJack.osc.init()});